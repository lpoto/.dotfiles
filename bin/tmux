#!/bin/sh
#
# This script will start tmux built in the .build directory.
# If it is not found, it will ask if you want to build it, and then
# build it from source.
#
# This will start tmux with the .config/tmux/tmux.conf file passed
# as the source file.

set -e

dotfiles=$(dirname $(dirname "$0"))
tmux_path=${dotfiles}/.build/tmux/tmux

if [ ! -f "${tmux_path}" ]; then
  echo "Tmux not found at ${tmux_path}"
  read -p "Build it from source? [Y/N] " REPLY
  echo

  if [ "$REPLY" != "y" ] && [ "$REPLY" != "Y" ]; then
    echo "Not building tmux, exiting ..."
    exit
  fi
  echo "==> building tmux..."
  echo
  ${dotfiles}/scripts/build/tmux
  echo
  echo "==> starting tmux ..."
  sleep 3
fi

args=$@
if [ $# -eq 0 ]; then
  args="new"
fi

LD_LIBRARY_PATH=${dotfiles}/.build/tmux/lib:${LD_LIBRARY_PATH}

dotfiles_bin="${dotfiles}/bin"
PATH="${dotfiles_bin}:${PATH}"

LD_LIBRARY_PATH=${LD_LIBRARY_PATH} \
  PATH=${PATH} \
  ${tmux_path} source ${dotfiles}/tmux/tmux.conf \; $args
