#!/bin/sh
#
# This script will start neovim built in the .build directory.
# If it is not found, it will ask if you want to build it, and then
# build it from source.
#
# This will modify thje XDG environment variables for the neovim's
# runtime, so all the configs, plugins and logs will be stored
# in the .dotfiles directory, instead of saving data all over the
# machine.

dotfiles=$(dirname $(dirname "$0"))
nvim_path=${dotfiles}/.build/neovim/build/bin/nvim


if [ ! -f "${nvim_path}" ]; then
    echo "Neovim not found at ${nvim_path}"
    read -p "Build it from source? [Y/N] " REPLY
    echo

    if [ "$REPLY" != "y" ] && [ "$REPLY" != "Y" ]; then
        echo "Not building neovim, exiting ..."
        exit
    fi
    echo "==> building neovim ..."
    echo
    ${dotfiles}/scripts/build/nvim
    echo
    echo "==> opening neovim ..."
    sleep 3
fi



DOTFILES_CONFIG_HOME=${dotfiles}/.config
DOTFILES_DATA_HOME=${dotfiles}/.local/share
DOTFILES_RUNTIME_DIR=${dotfiles}/.local/share
DOTFILES_STATE_HOME=${dotfiles}/.local/state

dotfiles_bin="${dotfiles}/bin"
PATH="${dotfiles_bin}:${PATH}"

XDG_CONFIG_HOME=${DOTFILES_CONFIG_HOME} \
    XDG_DATA_HOME=${DOTFILES_DATA_HOME} \
    XDG_RUNTIME_DIR=${DOTFILES_RUNTIME_DIR} \
    XDG_STATE_HOME=${DOTFILES_STATE_HOME} \
    PATH=${PATH} \
    ${nvim_path} $@
